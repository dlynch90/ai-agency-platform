# Unified Pixi Environment for All Development Workloads
# Combines FEA, ROS2, and Node.js environments with feature flags

[workspace]
authors = ["Daniel Lynch <developer@empathyfirstmedia.com>"]
channels = ["conda-forge", "https://prefix.dev/conda-forge", "https://prefix.dev/robostack-humble"]
name = "unified-dev"
platforms = ["osx-arm64", "linux-64"]
version = "0.1.0"

# Base dependencies available in all environments
[dependencies]
# Python core
python = ">=3.14.2,<3.15"

# Node.js core
nodejs = ">=25.2.1,<25.3"
npm = ">=10.2.0,<11"

# Rust core
rust = ">=1.92.0,<1.93"
cargo = ">=1.92.0,<1.93"

# Development tools (always available)
git = ">=2.40.0,<3"
curl = ">=8.0.0,<9"
wget = ">=1.21.0,<2"

# ==========================================
# FEA FEATURE - Finite Element Analysis
# ==========================================
[feature.fea.dependencies]
# Core scientific computing stack
numpy = ">=1.26.0,<2"
scipy = ">=1.11.0,<2"
matplotlib = ">=3.8.0,<4"
pandas = ">=2.1.0,<3"
sympy = ">=1.12.0,<2"

# FEA solvers and libraries
fenics = ">=2019.1.0"  # Finite element library
dealii = ">=9.5.0"     # C++ finite element library
mfem = ">=4.6.0"       # Lightweight FEM library
libmesh = ">=1.8.0"    # C++ FEM framework

# Meshing tools
gmsh = ">=4.11.0"      # 3D finite element mesh generator
tetgen = ">=1.6.0"     # tetrahedral mesh generator
netgen = ">=6.2.0"     # automatic mesh generator

# Visualization and post-processing
pyvista = ">=0.42.0"   # 3D plotting and mesh analysis
mayavi = ">=4.8.0"     # 3D scientific visualization
paraview = ">=5.11.0"  # scientific visualization application

# Material modeling and physics
pymatgen = ">=2023.12.0"  # materials analysis library
ase = ">=3.22.0"         # atomic simulation environment
spglib = ">=2.2.0"       # crystal symmetry library

# Optimization and design
pyomo = ">=6.7.0"       # optimization modeling language
nlopt = ">=2.7.0"       # nonlinear optimization library
openmdao = ">=3.30.0"   # multidisciplinary design optimization

# Machine learning for FEA
scikit-learn = ">=1.4.0,<2"
tensorflow = ">=2.15.0,<3"
pytorch = ">=2.1.0,<3"

# Development tools for FEA
jupyter = ">=1.0.0,<2"
notebook = ">=7.0.0,<8"
ipykernel = ">=6.25.0,<7"

# ==========================================
# ROS2 FEATURE - Robotics Development
# ==========================================
[feature.ros2.dependencies]
# ROS 2 Humble Hawksbill
ros-humble-desktop = ">=0.10.0,<0.11"

# ROS 2 development tools
colcon = ">=0.6.0,<0.7"
rosdep = ">=0.22.0,<0.23"

# Build tools
cmake = ">=3.27.0,<4"
make = ">=4.4.0,<5"
gcc = ">=12.0.0,<13"
gxx = ">=12.0.0,<13"

# Python development for ROS2
pip = ">=23.0.0,<24"
setuptools = ">=68.0.0,<69"
wheel = ">=0.41.0,<0.42"

# ==========================================
# SIMULATION FEATURE (ROS2)
# ==========================================
[feature.simulation.dependencies]
ros-humble-gazebo = ">=11.0,<12"
ros-humble-rviz2 = ">=11.0,<12"
ros-humble-navigation2 = ">=1.1,<2"

# ==========================================
# PERCEPTION FEATURE (ROS2)
# ==========================================
[feature.perception.dependencies]
ros-humble-vision-opencv = ">=3.2,<4"
ros-humble-image-transport = ">=4.0,<5"
opencv = ">=4.8.0,<5"

# ==========================================
# CONTROL FEATURE (ROS2)
# ==========================================
[feature.control.dependencies]
ros-humble-control = ">=2.0,<3"
ros-humble-ros2-control = ">=2.0,<3"

# ==========================================
# NODE.JS DEVELOPMENT FEATURE
# ==========================================
[feature.node-dev.dependencies]
# Additional Node.js development tools
typescript = ">=5.3.0,<6"
eslint = ">=8.55.0,<9"
prettier = ">=3.1.0,<4"

# Testing frameworks
vitest = ">=1.0.0,<2"
playwright = ">=1.40.0,<2"

# Build tools
webpack = ">=5.89.0,<6"
rollup = ">=4.9.0,<5"
vite = ">=5.0.0,<6"

# Development servers
http-server = ">=14.1.0,<15"

yarn = ">=1.22.0,<2"

# ==========================================
# REACT FEATURE (Node.js)
# ==========================================
[feature.react.dependencies]
react = ">=18.2.0,<19"
"react-dom" = ">=18.2.0,<19"
nextjs = ">=14.0.0,<15"

# ==========================================
# VUE FEATURE (Node.js)
# ==========================================
[feature.vue.dependencies]
vue = ">=3.4.0,<4"
nuxt = ">=3.9.0,<4"

# ==========================================
# EXTENDED TESTING FEATURE (Node.js)
# ==========================================
[feature.testing-extended.dependencies]
jest = ">=29.7.0,<30"
cypress = ">=13.6.0,<14"
testing-library = ">=14.0.0,<15"

# ==========================================
# INFRASTRUCTURE FEATURE
# ==========================================
[feature.infra.dependencies]
# Cloud and infrastructure tools
terraform = ">=1.9.0,<2"
kubectl = ">=1.32.0,<1.33"
helm = ">=3.16.0,<4"
awscli = ">=2.22.0,<3"

# Container tools
docker = ">=27.4.0,<28"

# Go for infrastructure tools
go = ">=1.23.0,<2"

# ==========================================
# TASKS - Unified Command Interface
# ==========================================

[tasks]
# Environment setup
setup = "echo 'ðŸ”§ Unified development environment ready'"
start = "python -c 'print(\"ðŸŽ¯ Unified Environment Ready - Use pixi run <task>\")'"

# FEA tasks
fea = "python -c 'import numpy, scipy, matplotlib; print(\"ðŸ”¬ FEA libraries loaded successfully\")'"
mesh = "gmsh --version"
solve = "python scripts/fea_solver.py"
visualize = "python scripts/fea_visualize.py"
optimize = "python scripts/fea_optimize.py"

# ROS2 tasks (requires ros2 feature)
ros-setup = "source /opt/ros/humble/setup.bash && rosdep init && rosdep update"
ros-build = "source /opt/ros/humble/setup.bash && colcon build"
ros-test = "source /opt/ros/humble/setup.bash && colcon test"
ros-run = "source /opt/ros/humble/setup.bash && ros2 run"
ros-launch = "source /opt/ros/humble/setup.bash && ros2 launch"

# Gazebo simulation (requires simulation feature)
gazebo = "source /opt/ros/humble/setup.bash && gazebo"
rviz = "source /opt/ros/humble/setup.bash && rviz2"
nav2 = "source /opt/ros/humble/setup.bash && ros2 launch nav2_bringup bringup_launch.py"

# Perception tasks (requires perception feature)
camera = "source /opt/ros/humble/setup.bash && ros2 run image_tools cam2image"
opencv-demo = "source /opt/ros/humble/setup.bash && ros2 run vision_opencv image_view image:=/camera/image_raw"

# Control tasks (requires control feature)
control-demo = "source /opt/ros/humble/setup.bash && ros2 launch ros2_control_demo_example demo.launch.py"

# Node.js tasks (requires node-dev feature)
node-install = "npm install"
node-dev = "npm run dev"
node-build = "npm run build"
node-test = "npm test"
node-lint = "npm run lint"
node-serve = "npx http-server dist -p 3000"

# React tasks (requires react feature)
react-dev = "npm run dev"
react-build = "npm run build"

# Vue tasks (requires vue feature)
vue-dev = "npm run dev"
vue-build = "npm run build"

# Quality checks
lint = "npm run lint"
test = "npm test"
quality = "pixi run lint && pixi run test"

# Build all
build = "npm run build"

# Clean tasks
clean = "rm -rf node_modules dist build .next .nuxt"
clean-ros = "rm -rf build install log"
clean-all = "pixi run clean && pixi run clean-ros"

# Development workflows
setup-dev = "pixi run node-install && pixi run quality"
ci = "pixi run setup-dev && pixi run build && pixi run test"

# Package management
create-ros-pkg = "source /opt/ros/humble/setup.bash && ros2 pkg create --build-type ament_python"
create-ros-cpp-pkg = "source /opt/ros/humble/setup.bash && ros2 pkg create --build-type ament_cmake"

# ==========================================
# ENVIRONMENTS - Pre-configured Development Modes
# ==========================================

[environments]
# Basic development (Python, Node.js, Rust)
basic = []

# Finite Element Analysis
fea = ["fea"]

# Robotics development
robotics = ["ros2"]
robotics-full = ["ros2", "simulation", "perception", "control"]

# Web development
web = ["node-dev"]
web-react = ["node-dev", "react"]
web-vue = ["node-dev", "vue"]
web-full = ["node-dev", "react", "vue", "testing-extended"]

# Infrastructure
infra = ["infra"]

# Full development environment
full = ["fea", "ros2", "simulation", "perception", "control", "node-dev", "react", "vue", "testing-extended", "infra"]