// Prisma Schema for AI Agency Platform
// Multi-tenant database with PostgreSQL primary + Neo4j graph relationships

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id        String   @id @default(cuid())
  name      String
  domain    String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  users     User[]
  projects  Project[]
  campaigns Campaign[]
  clients   Client[]

  @@map("tenants")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  role      UserRole @default(USER)
  tenantId  String
  clerkId   String   @unique // Clerk authentication ID
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relationships
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projects  Project[]

  @@map("users")
}

model Client {
  id          String   @id @default(cuid())
  name        String
  email       String
  company     String?
  tenantId    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relationships
  tenant      Tenant     @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  campaigns   Campaign[]

  @@map("clients")
}

model Project {
  id          String      @id @default(cuid())
  name        String
  description String?
  status      ProjectStatus @default(ACTIVE)
  tenantId    String
  userId      String
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  // Relationships
  tenant      Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  campaigns   Campaign[]

  @@map("projects")
}

model Campaign {
  id          String        @id @default(cuid())
  name        String
  type        CampaignType
  status      CampaignStatus @default(DRAFT)
  budget      Float?
  startDate   DateTime?
  endDate     DateTime?
  tenantId    String
  clientId    String
  projectId   String
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  // Relationships
  tenant      Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  client      Client        @relation(fields: [clientId], references: [id], onDelete: Cascade)
  project     Project       @relation(fields: [projectId], references: [id], onDelete: Cascade)
  contents    Content[]

  @@map("campaigns")
}

model Content {
  id          String       @id @default(cuid())
  title       String
  type        ContentType
  status      ContentStatus @default(DRAFT)
  campaignId  String
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  // Relationships
  campaign    Campaign     @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@map("contents")
}

model AIModel {
  id          String     @id @default(cuid())
  name        String
  provider    String     // huggingface, openai, etc.
  modelId     String     // Model identifier
  version     String?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@map("ai_models")
}

model Experiment {
  id          String            @id @default(cuid())
  name        String
  type        ExperimentType
  status      ExperimentStatus  @default(RUNNING)
  parameters  Json?
  metrics     Json?
  modelId     String?
  createdAt   DateTime          @default(now())
  updatedAt   DateTime          @updatedAt

  @@map("experiments")
}

// Enums
enum UserRole {
  ADMIN
  MANAGER
  USER
}

enum ProjectStatus {
  ACTIVE
  COMPLETED
  ON_HOLD
  CANCELLED
}

enum CampaignType {
  EMAIL
  SOCIAL
  PPC
  SEO
  CONTENT
  VIDEO
}

enum CampaignStatus {
  DRAFT
  PLANNING
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum ContentType {
  ARTICLE
  SOCIAL_POST
  EMAIL
  VIDEO
  IMAGE
  LANDING_PAGE
}

enum ContentStatus {
  DRAFT
  REVIEW
  APPROVED
  PUBLISHED
  ARCHIVED
}

enum ExperimentType {
  CONTENT_GENERATION
  CAMPAIGN_OPTIMIZATION
  AUDIENCE_SEGMENTATION
  PREDICTIVE_ANALYTICS
}

enum ExperimentStatus {
  RUNNING
  COMPLETED
  FAILED
  STOPPED
}