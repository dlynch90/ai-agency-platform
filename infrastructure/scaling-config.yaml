# Vendor-Only Scaling Configuration
# Uses Kubernetes, Docker Swarm, and vendor scaling tools
# No custom scaling implementations

apiVersion: v1
kind: ConfigMap
metadata:
  name: ai-agency-scaling-config
  namespace: ai-agency
data:
  # Horizontal Pod Autoscaling Configuration
  hpa-config: |
    apiVersion: autoscaling/v2
    kind: HorizontalPodAutoscaler
    metadata:
      name: api-gateway-hpa
      namespace: ai-agency
    spec:
      scaleTargetRef:
        apiVersion: apps/v1
        kind: Deployment
        name: api-gateway
      minReplicas: 3
      maxReplicas: 50
      metrics:
      - type: Resource
        resource:
          name: cpu
          target:
            type: Utilization
            averageUtilization: 70
      - type: Resource
        resource:
          name: memory
          target:
            type: Utilization
            averageUtilization: 80

  # Docker Compose Scaling (for development)
  docker-scaling: |
    version: '3.8'
    services:
      api-gateway:
        deploy:
          replicas: 3
          resources:
            limits:
              cpus: '1.0'
              memory: 1G
            reservations:
              cpus: '0.5'
              memory: 512M
          restart_policy:
            condition: on-failure
            delay: 5s
            max_attempts: 3
            window: 120s

      ollama:
        deploy:
          replicas: 1
          resources:
            limits:
              cpus: '2.0'
              memory: 8G
            reservations:
              cpus: '1.0'
              memory: 4G

  # Redis Cluster Configuration
  redis-cluster: |
    version: '3.8'
    services:
      redis-master:
        image: redis:7-alpine
        ports:
          - "6379:6379"
        command: redis-server --appendonly yes
        volumes:
          - redis-data:/data
        deploy:
          replicas: 1

      redis-replica:
        image: redis:7-alpine
        command: redis-server --slaveof redis-master 6379
        depends_on:
          - redis-master
        deploy:
          replicas: 2

    volumes:
      redis-data:

  # Load Balancer Configuration (Caddy)
  caddy-config: |
    {
      "apps": {
        "http": {
          "servers": {
            "ai-agency": {
              "listen": [":443"],
              "routes": [
                {
                  "match": {"host": ["api.ai-agency.com"]},
                  "handle": [
                    {
                      "handler": "reverse_proxy",
                      "upstreams": [
                        {"dial": "api-gateway:8080"},
                        {"dial": "api-gateway:8081"},
                        {"dial": "api-gateway:8082"}
                      ]
                    }
                  ]
                }
              ]
            }
          }
        }
      }
    }

  # Monitoring Scaling (Prometheus Federation)
  prometheus-federation: |
    global:
      scrape_interval: 15s
      evaluation_interval: 15s

    scrape_configs:
      - job_name: 'federate'
        scrape_interval: 15s
        honor_labels: true
        metrics_path: '/federate'
        params:
          'match[]':
            - '{job=~".+"}'
        static_configs:
          - targets:
            - 'prometheus-1:9090'
            - 'prometheus-2:9090'
            - 'prometheus-3:9090'