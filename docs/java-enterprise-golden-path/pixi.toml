[workspace]
authors = ["Daniel Lynch <developer@empathyfirstmedia.com>"]
channels = ["conda-forge"]
name = "java-enterprise-golden-path"
platforms = ["osx-arm64", "linux-64"]
version = "1.0.0"

[dependencies]
# Java Development
openjdk = ">=21.0.0,<22"
maven = ">=3.9.0,<4"

# Build tools
make = ">=4.4.0,<5"

# Testing and quality
checkstyle = ">=10.12.0,<11"

[feature.testing]
platforms = ["osx-arm64", "linux-64"]
channels = ["conda-forge"]
dependencies = { testcontainers = ">=1.19.0,<2" }

[feature.database]
platforms = ["osx-arm64", "linux-64"]
channels = ["conda-forge"]
dependencies = { postgresql = ">=15.0,<16" }

[tasks]
# Build tasks
build = "mvn clean compile"
package = "mvn clean package"
install = "mvn clean install"

# Test tasks
test = "mvn test"
test-integration = "mvn verify"
test-with-containers = "pixi run --feature testing test-integration"

# Quality checks
checkstyle = "mvn checkstyle:check"
quality = "pixi run checkstyle"

# Database tasks
db-migrate = "mvn flyway:migrate"
db-clean = "mvn flyway:clean"

# Development tasks
dev = "mvn spring-boot:run"
dev-with-db = "pixi run --feature database dev"

# Clean tasks
clean = "mvn clean"
clean-all = "pixi run clean && rm -rf target"

# Full build pipeline
ci = """
pixi run clean &&
pixi run test &&
pixi run quality &&
pixi run package
"""

# Run with database
full-dev = """
pixi run --feature database db-migrate &&
pixi run --feature database dev
"""

[environments]
development = ["testing"]
production = ["database"]
ci = ["testing", "database"]