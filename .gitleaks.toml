# Gitleaks Configuration for Chezmoi Variable Enforcement
# Extends default gitleaks rules with path/port detection
# Created: 2025-12-29 via Finite Element Gap Analysis

title = "Chezmoi Variable Enforcement"

# Extend default rules (don't replace)
[extend]
useDefault = true

# =============================================================================
# CUSTOM RULES - Hardcoded Path Detection
# =============================================================================

[[rules]]
id = "hardcoded-home-path"
description = "Hardcoded /Users/ or /home/ path detected - use $CHEZMOI_HOME or $CHEZMOI_WORKSPACE"
regex = '''(/Users/[a-zA-Z0-9_-]+/|/home/[a-zA-Z0-9_-]+/)'''
tags = ["portability", "chezmoi", "path"]
keywords = ["/Users/", "/home/"]

[[rules]]
id = "hardcoded-localhost-ollama"
description = "Hardcoded localhost:11434 (Ollama) - use $CHEZMOI_OLLAMA_URL"
regex = '''localhost:11434'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:11434"]

[[rules]]
id = "hardcoded-localhost-qdrant"
description = "Hardcoded localhost:6333 (Qdrant) - use $CHEZMOI_QDRANT_URL"
regex = '''localhost:6333'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:6333"]

[[rules]]
id = "hardcoded-localhost-neo4j"
description = "Hardcoded localhost:7687 (Neo4j) - use $CHEZMOI_NEO4J_BOLT"
regex = '''localhost:7687'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:7687"]

[[rules]]
id = "hardcoded-localhost-redis"
description = "Hardcoded localhost:6379 (Redis) - use $CHEZMOI_REDIS_URL"
regex = '''localhost:6379'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:6379"]

[[rules]]
id = "hardcoded-localhost-postgres"
description = "Hardcoded localhost:5432 (Postgres) - use $CHEZMOI_POSTGRES_URL"
regex = '''localhost:5432'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:5432"]

[[rules]]
id = "hardcoded-localhost-mem0"
description = "Hardcoded localhost:3001 (Mem0/MCP) - use $CHEZMOI_MEM0_URL"
regex = '''localhost:3001'''
tags = ["portability", "chezmoi", "service"]
keywords = ["localhost:3001"]

# =============================================================================
# ALLOWLIST - Files that legitimately need hardcoded values
# =============================================================================

[allowlist]
description = "Allow hardcoded values in specific contexts"
paths = [
    # Docker Compose port mappings (need literal ports)
    '''.*docker-compose.*\.ya?ml$''',
    # Documentation files
    '''.*\.md$''',
    # Chezmoi source templates (these generate the exports)
    '''\.chezmoidata\.toml$''',
    # Test fixtures
    '''.*test.*fixture.*''',
    # Generated reports
    '''.*report.*\.json$''',
]
