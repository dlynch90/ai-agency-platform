#!/bin/bash
# Official Gibson CLI wrapper - Uses GibsonAI's gibson-cli from PyPI
# Installed via: pip install gibson-cli (Python 3.11 required)

# Gibson CLI wrapper - Fixed configuration and environment issues
# Fixes applied based on runtime evidence analysis:
# - C1: Configuration.settings AttributeError - FIXED by creating ~/.gibsonai/config
# - D2: Docker credential helper PATH - FIXED by updating Docker config
# - B5: dump_zsh_state command - FIXED by creating stub

export PYTHONPATH="/Users/daniellynch/Library/Python/3.11/lib/python/site-packages:src:$PYTHONPATH"

exec python3.11 -c "
import sys
sys.path.insert(0, '/Users/daniellynch/Library/Python/3.11/lib/python/site-packages')

# #region agent log - Hypothesis G4: Import path resolution issues
import json
with open('/tmp/debug_session.log', 'a') as f:
    json.dump({
        'timestamp': __import__('time').time(),
        'hypothesisId': 'G4',
        'location': 'gibson-official:python',
        'message': 'Python import path setup',
        'data': {
            'sys_path': sys.path[:3],
            'python_version': sys.version,
            'executable': sys.executable
        }
    }, f)
    f.write('\n')
# #endregion

try:
    from gibson.bin.gibson import main
    # #region agent log - Hypothesis C1: Configuration initialization success
    with open('/tmp/debug_session.log', 'a') as f:
        json.dump({
            'timestamp': __import__('time').time(),
            'hypothesisId': 'C1',
            'location': 'gibson-official:python',
            'message': 'Gibson import successful',
            'data': {'module_loaded': True}
        }, f)
        f.write('\n')
    # #endregion
    main()
except Exception as e:
    # #region agent log - Hypothesis C1: Configuration initialization failure
    with open('/tmp/debug_session.log', 'a') as f:
        json.dump({
            'timestamp': __import__('time').time(),
            'hypothesisId': 'C1',
            'location': 'gibson-official:python',
            'message': 'Gibson execution failed',
            'data': {
                'error_type': type(e).__name__,
                'error_message': str(e),
                'traceback': __import__('traceback').format_exc()
            }
        }, f)
        f.write('\n')
    # #endregion
    raise
" "$@"