# Gitleaks configuration for secret detection
# Enforces chezmoi variable usage over hardcoded secrets

title = "AI Agency Platform Secrets"

[[rules]]
    id = "hardcoded-api-key"
    description = "Hardcoded API key"
    regex = '''(?i)(api[_-]?key|apikey|secret[_-]?key|access[_-]?key|auth[_-]?key)[\s]*[=:][\s]*['"]?([a-zA-Z0-9_-]{20,})['"]?'''
    tags = ["key", "hardcoded"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''\.env''',
            '''secrets/'''
        ]

[[rules]]
    id = "hardcoded-password"
    description = "Hardcoded password"
    regex = '''(?i)(password|passwd|pwd)[\s]*[=:][\s]*['"]?([^'"\s]{8,})['"]?'''
    tags = ["password", "hardcoded"]

[[rules]]
    id = "hardcoded-token"
    description = "Hardcoded token"
    regex = '''(?i)(token|bearer|jwt)[\s]*[=:][\s]*['"]?([a-zA-Z0-9_.-]{20,})['"]?'''
    tags = ["token", "hardcoded"]

[[rules]]
    id = "hardcoded-port"
    description = "Hardcoded port number (should use chezmoi variable)"
    regex = '''[:]([0-9]{4,5})'''
    tags = ["port", "hardcoded"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''package\.json''',
            '''docker-compose.*\.yml''',
            '''infra/''',
            '''configs/'''
        ]

[[rules]]
    id = "hardcoded-path"
    description = "Hardcoded file path (should use chezmoi variable)"
    regex = '''(/Users/|/home/|/tmp/|/var/|/opt/|/etc/)[a-zA-Z0-9/_-]+'''
    tags = ["path", "hardcoded"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''README\.md''',
            '''docs/''',
            '''scripts/'''
        ]

[[rules]]
    id = "console-log"
    description = "console.log usage (should use Pino)"
    regex = '''console\.log\(.*\)'''
    tags = ["logging", "custom"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''testing/''',
            '''scripts/'''
        ]

[[rules]]
    id = "custom-component"
    description = "Custom React component (should use vendor library)"
    regex = '''export.*function.*Component'''
    tags = ["react", "custom"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''apps/'''
        ]

[[rules]]
    id = "custom-hook"
    description = "Custom React hook (should use vendor library)"
    regex = '''export.*function.*use[A-Z]'''
    tags = ["react", "hook", "custom"]
    [rules.allowlist]
        paths = [
            '''node_modules/''',
            '''\.pixi/''',
            '''__pycache__/''',
            '''\.git/''',
            '''apps/'''
        ]

[extend]
# Use default gitleaks rules as well
useDefault = true